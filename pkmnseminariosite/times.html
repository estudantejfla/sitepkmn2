<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Meus Times</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <video autoplay muted loop id="bg-video" class="background-video">
    <source src="imagens/background.mp4" type="video/mp4">
  </video>
  <div class="container">
    <div class="navbar">
    <a href="index.html">Início</a>
    <a href="blog.html">Blog</a>
    <a href="postar.html">Nova Postagem</a>
    <a href="times.html">Meus Times</a>
    <a href="criar_time.html">Criar Time</a>
    <a href="publicos.html">Times Públicos</a>
    <a href="cadastro.html">Tipos</a>
    <a href="faq.html">FAQ</a>
    <a href="depoimentos.html">Depoimentos</a>
    <a href="sobre.html">Sobre</a>
  </div>

    <h1>Bem-vindo, <span id="usuario"></span>!</h1>
    <h2>Meus Times</h2>
    <div id="meusTimes"></div>
    <button onclick="window.location.href='criar_time.html'">Criar Novo Time</button><br><br>
    <a href="index.html" onclick="logout()">Sair</a>
  </div>

  <script>
    let user = localStorage.getItem("logado");
    let contas = JSON.parse(localStorage.getItem("contas")) || {};
    let pokemonList = [];
    if (!user || !contas[user]) {
      alert("Você precisa estar logado");
      window.location.href = "index.html";
    }
    document.getElementById("usuario").textContent = user;

    async function loadPokemonList() {
      for (let i = 1; i <= 152; i++) {
        let res = await fetch(`https://pokeapi.co/api/v2/pokemon/${i}`);
        let poke = await res.json();
        pokemonList.push(poke);
      }
      mostrarTimes();
    }

    function getSprite(name) {
      let p = pokemonList.find(p => p.name === name.toLowerCase());
      return p ? p.sprites.front_default : '';
    }

    function mostrarTimes() {
      let div = document.getElementById("meusTimes");
      let times = contas[user].times || [];
      div.innerHTML = times.length === 0 ? "<p>Você ainda não criou nenhum time.</p>" : "";
      times.forEach((time, i) => {
        let box = document.createElement("div");
        box.className = "card";
        let pokemons = time.pokemons.map(p => `
          <div class='pokemon-item'>
            ${getSprite(p) ? `<img src='${getSprite(p)}' width='40'>` : ''}
            <span>${p}</span>
          </div>`).join("");
        box.innerHTML = `
          <strong>${time.nome}</strong><br>
          <div class='pokemon-container'>${pokemons}</div>
          <div class='time-actions'>
            <button onclick='editarTime(${i})'>Editar</button>
            <button onclick='compartilharTime(${i})' class='share-btn'>Compartilhar</button>
            <button onclick='excluirTime(${i})' class='delete-btn'>Excluir</button>
          </div>`;
        div.appendChild(box);
      });
    }

    function editarTime(i) {
      window.location.href = `criar_time.html?edit=${i}`;
    }

    function compartilharTime(i) {
      let publicos = JSON.parse(localStorage.getItem("timesPublicos")) || [];
      let time = contas[user].times[i];
      if (!publicos.some(t => t.dono === user && t.nome === time.nome)) {
        publicos.push({ dono: user, nome: time.nome, pokemons: time.pokemons });
        localStorage.setItem("timesPublicos", JSON.stringify(publicos));
        alert("Time compartilhado!");
      } else {
        alert("Este time já foi compartilhado!");
      }
    }

    function excluirTime(i) {
      if (confirm("Deseja excluir este time?")) {
        contas[user].times.splice(i, 1);
        localStorage.setItem("contas", JSON.stringify(contas));
        mostrarTimes();
      }
    }

    function logout() {
      localStorage.removeItem("logado");
    }

    loadPokemonList();
  </script>
</body>
</html>
