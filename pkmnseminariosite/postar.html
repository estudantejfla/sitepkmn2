<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nova Postagem - Blog</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <video autoplay muted loop id="bg-video" class="background-video">
    <source src="imagens/background.mp4" type="video/mp4">
  </video>
  <div class="container">
    <div class="navbar">
    <a href="index.html">Início</a>
    <a href="blog.html">Blog</a>
    <a href="postar.html">Nova Postagem</a>
    <a href="times.html">Meus Times</a>
    <a href="criar_time.html">Criar Time</a>
    <a href="publicos.html">Times Públicos</a>
    <a href="cadastro.html">Tipos</a>
    <a href="faq.html">FAQ</a>
    <a href="depoimentos.html">Depoimentos</a>
    <a href="sobre.html">Sobre</a>
  </div>
    <h1>Criar Nova Postagem</h1>
    <div class="box">
      <label>Título</label>
      <input id="postTitle" placeholder="Título da postagem" />
      <label>Conteúdo</label>
      <textarea id="postBody" rows="8" placeholder="Escreva aqui..."></textarea>
      <button class="btn" onclick="salvarPost()">Publicar</button>
      <a class="btn secondary" href="blog.html">Cancelar</a>
    </div>
  </div>
  <script src="frontend-api.js"></script>
<script>
(async function(){
  const user = JSON.parse(localStorage.getItem("user")||"null");
  if (!user) { alert("Você precisa estar logado para postar no blog"); window.location.href = "index.html"; return; }

  document.querySelector('.btn[onclick="salvarPost()"]').addEventListener('click', salvarPost);

  async function salvarPost(){
    const title = document.getElementById('postTitle').value.trim();
    const body = document.getElementById('postBody').value.trim();
    if(!title || !body) return alert('Preencha título e conteúdo');

    const res = await apiFetch("/posts", {
      method: "POST",
      body: JSON.stringify({ title, content: body, authorId: user.id })
    });

    if (res.ok) {
      alert("Post publicado!");
      location.href = 'blog.html';
    } else {
      alert(res.data?.error || 'Erro ao publicar');
    }
  }
})();
</script>

  <script src="script.js"></script>
</body>
</html>
