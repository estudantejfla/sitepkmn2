<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Times Públicos</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <video autoplay muted loop id="bg-video" class="background-video">
    <source src="imagens/background.mp4" type="video/mp4">
  </video>

  <div class="container">

    <div class="navbar">
      <a href="index.html">Início</a>
      <a href="blog.html">Blog</a>
      <a href="postar.html">Nova Postagem</a>
      <a href="times.html">Meus Times</a>
      <a href="criar_time.html">Criar Time</a>
      <a href="publicos.html">Times Públicos</a>
      <a href="cadastro.html">Tipos</a>
      <a href="faq.html">FAQ</a>
      <a href="depoimentos.html">Depoimentos</a>
      <a href="sobre.html">Sobre</a>
    </div>

    <h1>Times Públicos</h1>

    <div id="lista">Carregando...</div>

    <br>
    <a href="times.html" class="back-button">Voltar</a>

  </div>

  <script src="frontend-api.js"></script>

<script>
(async function(){

  const user = JSON.parse(localStorage.getItem("user") || "null");
  if (!user) {
    alert("Você precisa estar logado para ver times públicos");
    return window.location.href = "index.html";
  }

  const res = await apiFetch("/teams/shared");
  const publicos = res.ok ? (res.data || []) : [];

  const nameToId = {};
  async function loadPokemonMap() {
    for (let i = 1; i <= 151; i++) {
      const r = await fetch(`https://pokeapi.co/api/v2/pokemon/${i}`);
      if (!r.ok) continue;
      const poke = await r.json();
      nameToId[poke.name.toLowerCase()] = i;
    }
  }

  function mostrarTimes() {
    const div = document.getElementById("lista");

    if (!publicos.length) {
      div.innerHTML = "<p>Nenhum time público ainda.</p>";
      return;
    }

    div.innerHTML = "";

    publicos.forEach(t => {
      let pokeList = [];
      try { pokeList = JSON.parse(t.pokemon || "[]"); }
      catch { pokeList = []; }

      const pokeHTML = pokeList.map(p => {
        const id = nameToId[p.toLowerCase()] || 1;
        return `
          <div class="pokemon-item">
            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png">
            <span>${p}</span>
          </div>`;
      }).join("");

      const card = document.createElement("div");
      card.className = "card time-card";
      card.innerHTML = `
        <h3>${t.name}</h3>
        <p class="time-owner">Por: ${t.owner?.username || t.ownerId}</p>
        <div class="pokemon-grid">${pokeHTML}</div>
      `;
      div.appendChild(card);
    });
  }

  await loadPokemonMap();
  mostrarTimes();

})();
</script>

</body>
</html>
