<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Times Públicos</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div class="navbar">
      <a href="index.html">Início</a>
      <a href="times.html">Meus Times</a>
      <a href="criar_time.html">Criar Time</a>
      <a href="publicos.html">Times Públicos</a>
    </div>
    <h1>Times Públicos</h1>
    <div id="lista">Carregando...</div>
    <a href="times.html">Voltar</a>
  </div>
<script src="frontend-api.js"></script>
<script>
const user = JSON.parse(localStorage.getItem("user") || "null");
if (!user) { alert("Você precisa estar logado"); window.location.href="index.html"; }
async function loadPublic(){
  const res = await apiFetch("/teams/shared");
  const teams = res.ok ? (res.data || []) : [];
  const nameToId = {};
  await Promise.all(teams.flatMap(t => t.pokemon || []).map(async name=>{
    if (nameToId[name]) return;
    try{
      const r = await fetch(`https://pokeapi.co/api/v2/pokemon/${name.toLowerCase()}`);
      if (!r.ok) return;
      const j = await r.json();
      nameToId[name] = j.id;
    }catch{}
  }));
  const div = document.getElementById("lista");
  if (!teams.length) { div.innerHTML = "Nenhum time público ainda."; return; }
  div.innerHTML = "";
  teams.forEach(t=>{
    const pokeHTML = (t.pokemon || []).map(p=>{
      const id = nameToId[p] || 1;
      return `<div class="pokemon-item"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png"><span>${p}</span></div>`;
    }).join("");
    const card = document.createElement("div");
    card.className = "card time-card";
    card.innerHTML = `<h3>${t.name}</h3><p>Por: ${t.owner?.username || t.ownerId}</p><div class="pokemon-grid">${pokeHTML}</div>`;
    div.appendChild(card);
  });
}
loadPublic();
</script>
</body>
</html>
