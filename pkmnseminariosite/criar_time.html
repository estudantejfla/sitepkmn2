<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Criar Time</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <video autoplay muted loop id="bg-video" class="background-video">
    <source src="imagens/background.mp4" type="video/mp4">
  </video>
  <div class="container">
    <div class="navbar">
    <a href="index.html">Início</a>
    <a href="blog.html">Blog</a>
    <a href="postar.html">Nova Postagem</a>
    <a href="times.html">Meus Times</a>
    <a href="criar_time.html">Criar Time</a>
    <a href="publicos.html">Times Públicos</a>
    <a href="cadastro.html">Tipos</a>
    <a href="faq.html">FAQ</a>
    <a href="depoimentos.html">Depoimentos</a>
    <a href="sobre.html">Sobre</a>
  </div>

    <h1>Criar/Editar Time</h1>
    <p>Usuário: <span id="usuario"></span></p>
    <input id="nomeTime" placeholder="Nome do Time"><br>

    <h3>Seu Time</h3>
    <div id="slots" class="grid"></div>

    <div id="pokemonModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <input type="text" id="pokemonSearch" oninput="buscarPokemon()" placeholder="Buscar Pokémon...">
        <div id="pokemonList" class="grid"></div>
      </div>
    </div>

    <button onclick="salvarTime()">Salvar Time</button><br><br>
    <button onclick="limparTime()" style="background-color: #f44336;">Limpar Time</button><br><br>
    <a href="times.html">Voltar</a>

    <script src="frontend-api.js"></script>
<script>
(async function(){
  const user = JSON.parse(localStorage.getItem("user")||"null");
  if (!user) { alert("Você precisa estar logado"); window.location.href = "index.html"; return; }
  document.getElementById("usuario").textContent = user.username || user.email;

  let slots = [];
  let editingId = null;
  const params = new URLSearchParams(location.search);
  if (params.has("edit")) editingId = params.get("edit");

  async function loadEdit() {
    if (!editingId) return mostrarSlots();
    const res = await apiFetch(`/teams/${editingId}`);
    if (!res.ok) return alert("Erro ao carregar time para edição");
    const team = res.data;
    document.getElementById("nomeTime").value = team.name;
    slots = team.pokemon || [];
    mostrarSlots();
  }

  function mostrarSlots() {
    const container = document.getElementById("slots");
    container.innerHTML = "";
    for (let i=0;i<6;i++){
      const div = document.createElement("div");
      div.className = "card";
      if (slots[i]) {
        div.innerHTML = `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${getPokemonId(slots[i])}.png"><p>${slots[i]}</p><button onclick='removerPokemon(${i})'>Remover</button>`;
      } else {
        div.innerHTML = `<button onclick='abrirModal(${i})'>Adicionar Pokémon</button>`;
      }
      container.appendChild(div);
    }
  }

  window.getPokemonId = function(name){ return slotsLikeIndex(name);  };

  window.selecionarPokemon = function(nome){
    slots[currentSlot] = nome;
    mostrarSlots();
    fecharModal();
  };

  async function salvarTime(){
    const nome = document.getElementById("nomeTime").value.trim();
    const pokemons = slots.filter(Boolean);
    if(!nome || pokemons.length===0) return alert("Nome e pelo menos 1 Pokémon obrigatórios");
    const payload = { ownerId: user.id, name: nome, pokemon: pokemons, description: "" };
    let res;
    if (editingId) res = await apiFetch(`/teams/${editingId}`, { method: "PUT", body: JSON.stringify(payload) });
    else res = await apiFetch(`/teams`, { method: "POST", body: JSON.stringify(payload) });

    if (res.ok) { alert("Time salvo!"); window.location.href = "times.html"; }
    else alert(res.data?.error||"Erro ao salvar time");
  }

  document.querySelector('button[onclick="salvarTime()"]').addEventListener('click', salvarTime);

  await loadEdit();
  mostrarSlots();
})();
</script>

  </div>
</body>
</html>
